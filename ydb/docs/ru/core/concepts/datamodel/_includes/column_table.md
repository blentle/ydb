## Колоночные таблицы {#olap-tables}

{% note warning %}

Колоночные таблицы {{ ydb-short-name }} доступны в режиме Preview.

{% endnote %}

Колоночная таблица {{ ydb-short-name }} — это реляционная таблица, содержащая набор связанных данных, состоящий из строк и столбцов. В отличии от обычных, строковых, [таблиц {{ ydb-short-name }}](#table), предназначенных для [OLTP-нагрузки](https://ru.wikipedia.org/wiki/OLTP), колоночные таблицы оптимизированы для задач анализа данных, [OLAP-нагрузки](https://ru.wikipedia.org/wiki/OLAP). 

На данный момент основной сценарий использования колоночных таблиц — запись данных с возрастающим первичным ключом (например, время события), анализ этих данных и удаление устаревших данных по TTL. Оптимальным способом добавления данных в колоночные таблицы является пакетная запись, выполяемая блоками в единицы мегабайт.

Вставка пакетов данных производится атомарно: данные будут записаны или во все партиции, или ни в одну из. При чтении анализируются только полностью записанные в колоночные таблицы данные.


### Особенности { #olap-vs-oltp-tables }
В большинстве случаев все описание работы строковых таблиц {{ ydb-short-name }} подходит и для описания колоночных таблиц, ниже приведены отличия. 

- В качестве ключевых колонок можно использовать только NOT NULL колонки.
- Данные партицируются не по первичному ключу, а по Hash от [колонок партиционирования](#olap-tables-partitioning).
- Поддерживается [ограниченный набор](#olap-data-types) типов данных.

{% note info %}

В настоящий момент не поддерживается: 
  - Чтение с реплик.
  - Вторичные индексы. 
  - Фильтры Блума.
  - Change Data Capture. 
  - Переименование таблиц. 
  - Пользовательские аттрибуты таблиц.
  - Изменение списка колонок данных в колоночных таблицах.
  - Добавление данных в колоночные таблицы с помощью SQL-команды `INSERT`.
  - Удаление данных из колоночных таблиц с помощью SQL-команды `DELETE`. Фактически, удаление возможно только по истечению TTL времени хранения данных.

{% endnote %}

### Поддерживаемые типы данных { #olap-data-types }

{% include [olap-data-types](../../../_includes/olap-data-types.md) %}

### Партиционирование { #olap-tables-partitioning }

В отличие от строковых таблиц {{ ydb-short-name }}, колоночные таблицы партиционируют данные не по первичным ключам, а по специально выделенным ключам — ключам партиционирования. Ключи партиционирования являются подмножеством первичных ключей таблицы. В отличие от партиционирования данных в строковых таблиц {{ ydb-short-name }}, партиционирование данных для колоночных таблиц выполняется не по значениям ключей, а по hash-значениям от ключей, что позволяет равномерно распределить данные во все существующие партиции.
Такое партиционирование позволяет избежать хотспотов при вставке и ускоряет аналитические запросы, обрабатывающие (считывающие) большие объемы данных.

Выбор ключей партиционирования существенно влияет на производительность колоночных таблиц. Подробнее про выбор ключей для партиционирования колоночных таблиц описано в разделе [Выбор ключа для максимальной производительности для колоночных таблиц](../../../best_practices/pk_olap_scalability.md).

Для управления партиционированием данных используется параметр AUTO_PARTITIONING_MIN_PARTITIONS_COUNT. Остальные параметры партиционирования для колоночных таблиц игнорируются.

#### AUTO_PARTITIONING_MIN_PARTITIONS_COUNT { #auto_partitioning_min_partitions_count }

* Тип: `Uint64`.
* Значение по умолчанию: `1`.

Определяет минимальное физическое количество партиций для хранения данных. С учетом, что остальные параметры партиционирования игнорируются, фактически это же значение определяет и верхнее число партиций для партиционирования.
