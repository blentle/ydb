# ClickBench нагрузка

Этот тест представляет типичную рабочую нагрузку в следующих областях: анализ потока кликов и трафика, веб-аналитика, машинно-генерируемые данные, структурированные журналы и данные о событиях. Он охватывает типичные запросы в аналитике и информационных панелях реального времени.

Набор данных из этого бенчмарка был получен на основе фактической записи трафика одной из крупнейших в мире платформ веб-аналитики. Он анонимизирован, сохраняя при этом все основные распределения данных. Набор запросов был импровизирован, чтобы отразить реалистичные рабочие нагрузки, в то время как запросы не исходят непосредственно из производства.

Нагрузка базируется на данных и запросах из репозитория [https://github.com/ClickHouse/ClickBench](https://github.com/ClickHouse/ClickBench)`, а запросы и схема таблица адаптированы под {{ ydb-short-name }}.

## Инициализация нагрузочного теста {#init}

Для начала работы необходимо создать таблицу
```bash
{{ ydb-cli }} workload click_bench init --path clickhouse
```

Посмотрите описание команды для запуска нагрузки:

```bash
{{ ydb-cli }} workload click_bench init --help
```

### Доступные параметры {#init_options}

Имя параметра | Описание параметра
---|---
`--path <значение>` | Директория, в которой будует создана таблица `hits`.

## Загрузка данных в таблицу {#load}

Для начала работы необходимо загрузить данные в таблицу. Для этого сначала необходимо скачать и распаковать архив с данными,
[https://datasets.clickhouse.com/hits_compatible/hits.csv.gz](https://datasets.clickhouse.com/hits_compatible/hits.csv.gz), после чего используя команду
`import file csv` необходимо загрузить данные в таблицу.

```bash
wget https://datasets.clickhouse.com/hits_compatible/hits.csv.gz
unzip hits.csv.gz
{{ ydb-cli }} import file csv --path clickhouse/hits --input-file hits.csv
```

## Запуск нагрузочного теста {#run}

Для запуска нагрузки необходимо выполнить команду:
```bash
{{ ydb-cli }} workload click_bench run --path clickhouse
```
В течение теста на экран выводится статистика по нагрузке для каждого временного окна.

Посмотрите описание команды для запуска нагрузки:

```bash
{{ ydb-cli }} workload click_bench run --help
```

### Общие параметры для всех видов нагрузки {#run_options}

Имя параметра | Описание параметра
---|---
`--output <значение>` |  Имя файла, в котором будут сохранены результаты выполния запросов. Значение по умолчанию 10.
`--iterations <значение>` | Количество выполнений каждого из запросов нагрузки, создающих нагрузку. Значение по умолчанию: 1.
`--json` | Имя файла, в котором будет сохранена статиска выполнения запросов в формате `json`. По умолчанию файл не сохраняется.
`--ministat` | Имя файла, в котором будет сохранена статиска выполнения запросов в формате `ministat`. По умолчанию файл не сохраняется.
`--window` | Длительность окна сбора статистики в секундах. Значение по умолчанию: 1.
`--disable-llvm` | Опция для отключения `llvm` компиляции запроса.
`--enable-pushdown` | Опция для включения возможности опускания агрегатов
`--ext-queries-file` | Имя файла, в котором можно указать внешние запросы для выполнения нагрузки. По умолчанию файл не требуется.
`--ext-query` | Строка с внешними запросами для выполнения нагрузки. Значение по умолчанию отсутствует.
`--table` | Имя таблицы. Значение по умолчанию: `hits`
`--path` | Путь до директории, в котором находится таблица. Значение по умолчанию отсутствует.
`--include` | Номера или отрезки номеров запросов, которые нужно выполнить в рамках нагрузки. По умолчанию выполняются все запросы.
`--exclude` | Номера или отрезки номеров запросов, которые нужно исключить в рамках нагрузки. По умолчанию выполняются все запросы.
